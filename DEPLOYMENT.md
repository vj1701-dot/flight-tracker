# 🚀 Flight Tracker - GCP Deployment Guide

## Quick Start Options

### Option 1: Production Deployment with Backup (Recommended)
```bash
./deploy-backup.sh deploy
```
This script will:
- ✅ Create automatic backup before deployment
- ✅ Deploy to Cloud Run with all environment variables
- ✅ Restore data from backup after deployment
- ✅ Provide deployment summary with data continuity

### Option 2: Simple Automated Deployment
```bash
./deploy-gcp.sh
```
This script will:
- ✅ Auto-generate JWT secret
- ✅ Set up GCP project and APIs
- ✅ Deploy to Cloud Run with all environment variables
- ✅ Provide deployment summary

### Option 2: Manual Cloud Build (Current Setup)
1. **Generate Environment Variables:**
   ```bash
   ./generate-env.sh
   ```

2. **Set Environment Variables in GCP Cloud Run:**
   - `NODE_ENV=production`
   - `JWT_SECRET=<generated_value>`
   - `TELEGRAM_BOT_TOKEN=<your_bot_token>`
   - `FLIGHTAWARE_API_KEY=<your_api_key>` (optional)

3. **Complete Cloud Build setup in GCP Console**

### Option 3: One-Command Environment Generation
```bash
# Just generate JWT secret and display template
./generate-env.sh
```

## Required Environment Variables

| Variable | Required | Description | How to Get |
|----------|----------|-------------|------------|
| `NODE_ENV` | ✅ Yes | Set to `production` | Auto-set |
| `JWT_SECRET` | ✅ Yes | 64-character secure secret | Auto-generated by scripts |
| `TELEGRAM_BOT_TOKEN` | ✅ Yes | Bot authentication token | Get from [@BotFather](https://t.me/BotFather) |
| `FLIGHTAWARE_API_KEY` | ⚠️ Optional | Flight data API access | Get from [FlightAware AeroAPI](https://flightaware.com/commercial/aeroapi/) |

## Deployment Methods

### 🎯 Method A: Full Automation
```bash
# One command deploys everything
./deploy-gcp.sh
```

### 🎯 Method B: Environment Variables Only
```bash
# Generate secrets, then use GCP console
./generate-env.sh
```

### 🎯 Method C: Manual Generation
```bash
# Generate JWT secret manually
openssl rand -hex 32
```

## Backup Management

### Automated Backup Commands
```bash
# Create manual backup
./deploy-backup.sh backup

# List all available backups
./deploy-backup.sh list

# Restore from specific backup
./deploy-backup.sh restore manual-2024-01-15T10-30-00-000Z

# Deploy with automatic backup and restore
./deploy-backup.sh deploy
```

### Backup Features
- ✅ **Automatic pre-deployment backups** - Data is backed up before each deployment
- ✅ **Automatic post-deployment restore** - Data is restored after successful deployment
- ✅ **Manual backup creation** - Create backups on-demand
- ✅ **Cross-deployment data continuity** - Passenger, volunteer, user, and flight data persists
- ✅ **Google Cloud Storage integration** - Secure, durable backup storage
- ✅ **Service health verification** - Ensures service is ready before restore operations
- ✅ **Automatic credential setup** - Configures GCS bucket and permissions automatically

### Prerequisites for Backup System
- **Google Cloud CLI** installed and authenticated (`gcloud auth login`)
- **Project permissions** to create storage buckets and manage IAM
- The script automatically handles bucket creation and service account permissions

## Post-Deployment

1. **Access your application** at the provided URL
2. **Login:** `superadmin` / `admin123`
3. **Change password immediately!**
4. **Test Telegram bot functionality**
5. **Set up users and permissions**
6. **Configure Flight Monitoring dashboard** (superadmin exclusive access)
7. **Verify backup functionality** using `./deploy-backup.sh list`

## Security Features

- ✅ **Auto-generated JWT secrets** (cryptographically secure)
- ✅ **No secrets in repository** (all externalized)
- ✅ **Production-optimized Docker build**
- ✅ **Non-root container execution**
- ✅ **Environment variable validation**

## Troubleshooting

### Script Permission Issues
```bash
chmod +x deploy-gcp.sh generate-env.sh
```

### Missing Tools
- **gcloud CLI:** https://cloud.google.com/sdk/docs/install
- **openssl:** Usually pre-installed on Mac/Linux
- **Node.js:** https://nodejs.org (if needed for JWT generation)

### Deployment Fails
1. Check GCP project permissions
2. Verify APIs are enabled
3. Confirm environment variables are set
4. Check Cloud Build logs in GCP console

## What Gets Deployed

- ✅ **Complete Flight Tracking System**
- ✅ **Timezone-aware flight times**
- ✅ **Automated monitoring system with superadmin dashboard**
- ✅ **Multi-user Telegram bot with smart notifications**
- ✅ **Responsive web interface with superadmin monitoring controls**
- ✅ **Production security hardening**

---

**Choose your preferred deployment method above and get your Flight Tracker running in minutes!** 🎉